import o from'./../../external/@swc/helpers/src/_async_to_generator.mjs.js';import{RESPONSE_CODE as e,MESSAGES as t}from"../../constants.js";import a from"../../utils/lodash.js";import{MPEEmitter as r,onActionMessage as i,fireActionMessage as n}from"../eventEmitter.js";import{parseJSON as l,getDynamicAPIByAction as c,checkIOSSupportAction as s,serialize as u}from"../../utils/common.js";import d from"../token.js";import{sendLogData as m}from"../utils.js";import p from"../../appEnv/getEnv.js";import{__generator as v}from'./../../external/tslib/tslib.es6.js';import{Events as f}from"../../types/enum.js";var _,h,T,g,I,b,j=(T=p(),g={},I=r.getInstance(),b=[],!1||(i((function(o){var e=o.serialId,t=l(o.result);if(e&&g[e]){var r=g[e],i=r.callback,n=r.timeout,s=r.isMultiCallback,u=r.options;!function(o,e){var t=e||{},r=t.success,i=t.fail,n=c(o.action),l=o.error_code;try{l=0!==o.error_code?o.error_code:n?JSON.parse(o.data).error_code:o.error_code}catch(o){}var s=o;try{s=n&&0===o.error_code?JSON.parse(o.data):o}catch(o){}0===l?a.isFunction(r)&&r(s):a.isFunction(i)&&i(s)}(t,i),!s&&delete g[e],n&&clearTimeout(n);var d={action:null==t?void 0:t.action,error:null==t?void 0:t.error_code,message:null==t?void 0:t.error_message,data:{}};try{if("action.open.inapp"===t.action||"action.open.outapp"===t.action){var m=new URL(null==u?void 0:u.url),p="".concat(m.protocol,"//").concat(m.host).concat(m.pathname);d.data={url:p}}if("action.follow.oa"===t.action||"action.unfollow.oa"===t.action){var v=null==u?void 0:u.uid;d.data={uid:v}}if("action.open.chat"===t.action){var f=null==u?void 0:u.uId,_=null==u?void 0:u.type;d.data={uid:f,openChatType:_}}}catch(o){}b.push(d)}})),I.on(f.AppPaused,(function(){if(b.length>0){var o=b;b=[],m(o)}})),_?clearInterval(_):_=setInterval((function(){if(b.length>0){var o=b;b=[],m(o)}}),5e3),!0),h=o((function(o,r,i,l){var m,p,f,_,h,I,b,j,M,k,N,w,O,S,C,y,E,J;return v(this,(function(v){switch(v.label){case 0:return p=Math.floor(1e6*Math.random()),f="".concat(o,"_").concat(p),_="action.".concat(o.replace(/\_/g,".").toLowerCase()),(null==l?void 0:l.actionName)&&l.actionName.length>0&&(_=null==l?void 0:l.actionName),h=(null==l?void 0:l.isMultiCallback)||!1,I=!1!==(null==l?void 0:l.timeout)&&((null==l?void 0:l.timeout)||!0),b=(null==l?void 0:l.haveActionCallback)||!1,j=(null==l?void 0:l.skipJump)||!1,M=(null==l?void 0:l.requireAccessToken)||!1,r&&i&&(g[f]={options:r,callback:i,isMultiCallback:h},I&&b&&(g[f].timeout=setTimeout((function(){var a={serialId:f,result:{error_code:e.TIME_OUT,error_message:t.TIME_OUT,data:{timeout:I},action:o}};n(a)}),!0===I?8e3:1e3*I))),k=c(_),!(null==T||null===(m=T.platform)||void 0===m?void 0:m.isMobile)||!o||a.isUndefined(ZaloJavaScriptInterface)||T.platform.isIOS&&!s(o)||k&&!1===k.isSupported?(w={serialId:f,result:{error_code:e.CLIENT_NOT_SUPPORT,error_message:t.CLIENT_NOT_SUPPORT,data:{isMobile:null==T||null===(N=T.platform)||void 0===N?void 0:N.isMobile},action:o}},n(w),[2]):(O=u(r),j?[3,2]:[4,d.getJSAccessToken()]);case 1:return C=v.sent(),[3,3];case 2:C="",v.label=3;case 3:return S=C,j||!M?[3,5]:[4,d.getAccessToken()];case 4:return E=v.sent(),[3,6];case 5:E="",v.label=6;case 6:return y=E,J=T.platform.isIOS?window.onNativeMessage(f):"window.onNativeMessage('".concat(f,"')"),[2,ZaloJavaScriptInterface.jsCall(S,_,y,O,J)]}}))})),function(o,e,t,a){return h.apply(this,arguments)});export{j as default};
